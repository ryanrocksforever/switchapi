<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>AMAZ-TECH | Fetch API</title>


    <style>
        .w3-allerta {
            font-family: "Allerta Stencil", Sans-serif;
        }
    </style>


</head>

<body class="page_bg">

    <div>
                    <div class="well">
                        <div class="gcontentform" id="generic-content-form">
                            <iframe width="0" height="0" border="0" name="dummyframe" id="dummyframe"></iframe>
                            <form action="https://switch-hub.local:80/account" method="POST" target="dummyframe">
                                <fieldset>
                                <div class="control-group">
                                    <label style="visibility: hidden;" for="id__content_type" class="control-label">Media type:</label>
                                    <div style="visibility: hidden;" class="controls">
                                        <select style="visibility: hidden;" id="id__content_type" name="_content_type">
                                        <option style="visibility: hidden;" value="application/json"  selected="selected">application/json</option>

                                        </select>
                                        <span style="visibility: hidden;" class="help-block"></span>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label style="visibility: hidden;" for="id__content" class="control-label">Content:</label>
                                    <div class="controls">
                                        <!--<textarea name="_content" cols="40" rows="10">{"id": "posasd"}</textarea> -->
                                        <p>Register User</p>
                                        <input id="usernamelab" readonly value="Username"></input>
                                        <br>
                                        <br>

                                        <input type="text" id="myInput" oninput="myFunction()">
                                        <input style="visibility: hidden;" type="text" readonly name="_content" class="form-control-plaintext" id="_content" >
                                        <p id="demo"></p>

                                        <script>
                                            async function apicall() {
                                                const fetchPromise = fetch("https://switch-hub.local:80/account");
                                                // Target main element
                                                const main = document.getElementById("main1");
                                                fetchPromise.then(response => {
                                                    return response.json();
                                                }).then(people => {
                                                    names = people.id;
                                                    udist = names.charAt(0)
                                                    // Append names to main element
                                                    //console.log(names);
                                                    //console.log(udist);
                                                    return(names, udist);

                                                });
                                                }


                                            count = 0

                                            names = "0000"
                                            function myFunction() {

                                              if(count == 0) {
                                                   userid = apicall();
                                               //console.log("firstTijme");
                                               count = count + 1;
                                               }
                                              userid = apicall();
                                              //console.log(userid);
                                              var x = document.getElementById("myInput").value;
                                              var start = "{\"id\": \"";
                                              var end = "\"}";
                                              //console.log(userid);
                                              var res = start.concat(x, end);
                                              //console.log(res)
                                              document.getElementById("demo").innerHTML = "You wrote: " + x;

                                              var xstart = x.charAt(0);
                                              //var uidst = userid.charAt(0)
                                              //console.log(udist);
                                              //console.log(xstart);

                                              if (x.charAt(0) == udist){
                                                console.log("boo hoo");
                                                document.getElementById("_content").value = "Already Registered";
                                                document.getElementById("_content").value = "Already Registered";
                                                document.getElementById("usernamelab").value = "User Already Registered";
                                                //document.getElementById("form-control-plaintext").style.visibility = "hidden";
                                                document.getElementById("regbutt").style.visibility = "hidden";

                                              } else {
                                                document.getElementById("_content").value = res;
                                                document.getElementById("regbutt").style.visibility = "visible";
                                                document.getElementById("usernamelab").value = "Username";
                                                //console.log("excellent");
                                              }
                                              }


                                        </script>

                                    </div>
                                </div>
                                <div class="form-actions">

                                    <button id="regbutt" class="btn btn-primary" onclick="location.href = 'https://ryanindustries.atamenterprise.net/?page_id=134';" title="Make a POST request on the resource">Register</button>



                                    </div>
                                </fieldset>
                            </form>
                        </div>
                    </div>
                </div>





</style>
</body>

</html>